% =============================
% Preamble for Rguroo Book Project
% =============================

% --- Required packages ---
\usepackage{hyperref}
\usepackage[most]{tcolorbox}
\usepackage{xcolor}

% --- Colors (Okabeâ€“Ito palette) ---
\definecolor{OIblue}{HTML}{0072B2}
\definecolor{OIsky}{HTML}{56B4E9}
\definecolor{OIgreen}{HTML}{009E73}
\definecolor{OIorange}{HTML}{E69F00}
\definecolor{OIverm}{HTML}{D55E00}
\definecolor{OIpurple}{HTML}{CC79A7}
\definecolor{OIblack}{HTML}{000000}

% --- Inline macros (for .var, .def, .fun, etc.) ---
\newcommand{\Var}[1]{\textcolor{OIblue}{\textit{#1}}}
\newcommand{\Def}[1]{\textcolor{OIpurple}{\textit{#1}}}
\newcommand{\Des}[1]{\textcolor{OIorange}{#1}}
\newcommand{\Data}[1]{\textcolor{OIsky}{\textit{#1}}}
\newcommand{\Dpd}[1]{\textcolor{OIgreen}{\textit{#1}}}
\newcommand{\Fun}[1]{\textcolor{OIverm}{\textit{#1}}}
\newcommand{\Dialog}[1]{\textcolor{OIblue}{\textbf{#1}}}
\newcommand{\Repo}[1]{\textcolor{OIgreen}{\textbf{\textit{#1}}}}
\newcommand{\Ans}[1]{\textcolor{OIblack}{\textbf{#1}}}
\newcommand{\Typein}[1]{%
  \colorbox{blue!2}{\texttt{\textcolor{black}{#1}}}%
}
\newtcbox{\Button}{on line,
  colback=gray!5,
  coltext=black,
  colframe=gray!40,
  boxrule=0.4pt,
  left=2pt,right=2pt,top=1pt,bottom=1pt,
  arc=1mm, boxsep=0pt, nobeforeafter}

% --- QCallout boxes for PDF (LaTeX rendering) ---
\newtcolorbox{qcalloutbox}[2][]{%
  enhanced, breakable,
  colback=blue!2, colframe=blue!40!black,
  title={#2}, fonttitle=\bfseries,
  left=6pt, right=6pt, top=6pt, bottom=6pt,
  boxsep=4pt, arc=2mm, #1
}

\NewDocumentEnvironment{QCallout}{ m m }{%
  \hypertarget{#1}{}%
  \begin{qcalloutbox}{#2}%
}{%
  \end{qcalloutbox}
}

% --- Example / Solution environments (for filters/example-solution.lua) ---
\usepackage{xparse}

% Choose chapter-based numbering when chapters exist, otherwise section-based.
\makeatletter
\@ifundefined{c@chapter}{%
  \newcounter{example}[section]
  \renewcommand{\theexample}{\thesection.\arabic{example}}
}{%
  \newcounter{example}[chapter]
  \renewcommand{\theexample}{\thechapter.\arabic{example}}
}
\makeatother

% \begin{Example}{<id>}[<optional title>] ... \end{Example}
\NewDocumentEnvironment{Example}{ m o }{%
  \refstepcounter{example}%
  \label{#1}%
  \begin{qcalloutbox}{Example~\theexample\IfValueT{#2}{: #2}}%
}{%
  \end{qcalloutbox}%
}

% \begin{Solution}{<id>} ... \end{Solution}
\NewDocumentEnvironment{Solution}{ m }{%
  \begin{qcalloutbox}{Solution to Example~\ref{#1}}%
}{%
  \end{qcalloutbox}%
}

